name: dynamic-execution
on:
  push:
    branches:
      - master
      - main
  pull_request:
    branches:
      - main
jobs:
  dynamic:
    name: dynamic
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup node
        uses: actions/setup-node@v1
        with:
          version: 16
      - name: Install octokit/action
        run: npm install @octokit/action
      - name: Execute script
        run: node .github/actions/my-script.js
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          SHA: ${{ github.sha }}

        # env:
        #   github_token: ${{ secrets.GITHUB_TOKEN }}
        #   personal_github_token: ${{ secrets.PERSONAL_GITHUB_TOKEN }}
        # run: |
        #   echo ${GITHUB_SHA::8}
        #   echo ${GITHUB_SHA}
        #   
        #   echo "sleep 5s"
        #   sleep 10s
        #   echo "sleeped"
        # 
        #   echo "start update"
        # 
        #   curl --request POST \
        #   --url https://api.github.com/repos/${{ github.repository }}/statuses/${{ github.sha }} \
        #   -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
        #   -H "Accept: application/vnd.github.v3+json" \
        #   --data '{
        #     "context": "lint",
        #     "state": "success",
        #     "description": "lint passed"
        #   }'
        #   
        #   echo "updated"
        # 
        #   echo "sleep 5s"
        #   sleep 5s
        #   echo "sleeped"
